module lists where

open import Agda.Primitive using (Level; lzero; lsuc; _âŠ”_) public
open import Relation.Binary.PropositionalEquality
  renaming (cong to ap ; sym to infix 30 _â»Â¹ ; trans to infixl 20 _âˆ™_ ; subst to tr)
  hiding ([_]) public
open â‰¡-Reasoning public
open import Function public

Type : (â„“ : Level) â†’ Set (lsuc â„“)
Type â„“ = Set â„“

Typeâ‚€ : Type (lsuc lzero)
Typeâ‚€ = Type lzero

private
  variable
    â„“ â„“â‚ â„“â‚‚ â„“â‚ƒ : Level

apâ‚‚ : {A : Type â„“â‚} {B : Type â„“â‚‚} {C : Type â„“â‚ƒ} {xâ‚ xâ‚‚ : A} {yâ‚ yâ‚‚ : B}
  (f : A â†’ B â†’ C) â†’ xâ‚ â‰¡ xâ‚‚ â†’ yâ‚ â‰¡ yâ‚‚ â†’ f xâ‚ yâ‚ â‰¡ f xâ‚‚ yâ‚‚
apâ‚‚ f refl refl = refl

trâ‚‚ : {A : Type â„“â‚} {B : Type â„“â‚‚} (P : A â†’ B â†’ Type â„“â‚ƒ) {xâ‚ xâ‚‚ : A} {yâ‚ yâ‚‚ : B}
  (p : xâ‚ â‰¡ xâ‚‚) (q : yâ‚ â‰¡ yâ‚‚) â†’ P xâ‚ yâ‚ â†’ P xâ‚‚ yâ‚‚
trâ‚‚ P refl refl x = x

apâ»Â¹ : {A : Type â„“â‚} {B : Type â„“â‚‚} (f : A â†’ B) {x y : A} (p : x â‰¡ y) â†’
  ap f p â»Â¹ â‰¡ ap f (p â»Â¹)
apâ»Â¹ f refl = refl

infixl 20 _âŠ¹_
data ğ¶ğ‘¡ğ‘¥ (ty : Type â„“) : Type â„“ where
  âˆ… : ğ¶ğ‘¡ğ‘¥ ty
  _âŠ¹_ : ğ¶ğ‘¡ğ‘¥ ty â†’ ty â†’ ğ¶ğ‘¡ğ‘¥ ty

mapğ¶ğ‘¡ğ‘¥ : {tyâ‚ : Type â„“â‚} {tyâ‚‚ : Type â„“â‚‚} (f : tyâ‚ â†’ tyâ‚‚) (Î“ : ğ¶ğ‘¡ğ‘¥ tyâ‚) â†’ ğ¶ğ‘¡ğ‘¥ tyâ‚‚
mapğ¶ğ‘¡ğ‘¥ f âˆ… = âˆ…
mapğ¶ğ‘¡ğ‘¥ f (Î“ âŠ¹ A) = mapğ¶ğ‘¡ğ‘¥ f Î“ âŠ¹ f A

mapğ¶ğ‘¡ğ‘¥Â² : {tyâ‚ : Type â„“â‚} {tyâ‚‚ : Type â„“â‚‚} {tyâ‚ƒ : Type â„“â‚ƒ}
  (g : tyâ‚‚ â†’ tyâ‚ƒ) (f : tyâ‚ â†’ tyâ‚‚) (Î“ : ğ¶ğ‘¡ğ‘¥ tyâ‚) â†’ mapğ¶ğ‘¡ğ‘¥ g (mapğ¶ğ‘¡ğ‘¥ f Î“) â‰¡ mapğ¶ğ‘¡ğ‘¥ (g âˆ˜ f) Î“
mapğ¶ğ‘¡ğ‘¥Â² g f âˆ… = refl
mapğ¶ğ‘¡ğ‘¥Â² g f (Î“ âŠ¹ A) = ap (_âŠ¹ g (f A)) (mapğ¶ğ‘¡ğ‘¥Â² g f Î“)

_âŠ¹âŠ¹_ : {ty : Type â„“} (Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’ ğ¶ğ‘¡ğ‘¥ ty
Î“ âŠ¹âŠ¹ âˆ… = Î“
Î“ âŠ¹âŠ¹ (Î” âŠ¹ A) = (Î“ âŠ¹âŠ¹ Î”) âŠ¹ A

data ğ‘‰ğ‘ğ‘Ÿ {ty : Type â„“} : (Î“ : ğ¶ğ‘¡ğ‘¥ ty) (A : ty) â†’ Type â„“ where
  ğ‘§ğ‘£ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ (Î“ âŠ¹ A) A
  ğ‘ ğ‘£ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ Î“ A â†’ ğ‘‰ğ‘ğ‘Ÿ (Î“ âŠ¹ B) A

prefixğ‘‰ğ‘ğ‘Ÿ : {ty : Type â„“} {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ Î“ A â†’ ğ¶ğ‘¡ğ‘¥ ty
prefixğ‘‰ğ‘ğ‘Ÿ {Î“ = Î“ âŠ¹ A} ğ‘§ğ‘£ = Î“
prefixğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘£ v) = prefixğ‘‰ğ‘ğ‘Ÿ v

removeğ‘‰ğ‘ğ‘Ÿ : {ty : Type â„“} {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ Î“ A â†’ ğ¶ğ‘¡ğ‘¥ ty
removeğ‘‰ğ‘ğ‘Ÿ {Î“ = Î“ âŠ¹ A} ğ‘§ğ‘£ = Î“
removeğ‘‰ğ‘ğ‘Ÿ {Î“ = Î“ âŠ¹ A} (ğ‘ ğ‘£ v) = removeğ‘‰ğ‘ğ‘Ÿ v âŠ¹ A

trğ‘‰ğ‘ğ‘Ÿ : {tyâ‚ : Type â„“â‚} {tyâ‚‚ : Type â„“â‚‚} (f : tyâ‚ â†’ tyâ‚‚) {Î“ : ğ¶ğ‘¡ğ‘¥ tyâ‚} {A : tyâ‚}
  â†’ ğ‘‰ğ‘ğ‘Ÿ Î“ A â†’ ğ‘‰ğ‘ğ‘Ÿ (mapğ¶ğ‘¡ğ‘¥ f Î“) (f A)
trğ‘‰ğ‘ğ‘Ÿ f ğ‘§ğ‘£ = ğ‘§ğ‘£
trğ‘‰ğ‘ğ‘Ÿ f (ğ‘ ğ‘£ v) = ğ‘ ğ‘£ (trğ‘‰ğ‘ğ‘Ÿ f v)

data ğ‘ƒğ‘œğ‘  {ty : Type â„“} : (Î“ : ğ¶ğ‘¡ğ‘¥ ty) â†’ Type â„“ where
  ğ‘§ğ‘ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} â†’ ğ‘ƒğ‘œğ‘  Î“
  ğ‘ ğ‘ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} â†’ ğ‘ƒğ‘œğ‘  Î“ â†’ ğ‘ƒğ‘œğ‘  (Î“ âŠ¹ A)

module _ {ty : Type â„“} where
  prefixğ‘ƒğ‘œğ‘  : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) â†’ ğ¶ğ‘¡ğ‘¥ ty
  prefixğ‘ƒğ‘œğ‘  {Î“ = Î“} ğ‘§ğ‘ = Î“
  prefixğ‘ƒğ‘œğ‘  (ğ‘ ğ‘ ğ‘–) = prefixğ‘ƒğ‘œğ‘  ğ‘–

  appendğ‘ƒğ‘œğ‘  : (Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’ ğ‘ƒğ‘œğ‘  (Î“ âŠ¹âŠ¹ Î”)
  appendğ‘ƒğ‘œğ‘  Î“ âˆ… = ğ‘§ğ‘
  appendğ‘ƒğ‘œğ‘  Î“ (Î” âŠ¹ A) = ğ‘ ğ‘ (appendğ‘ƒğ‘œğ‘  Î“ Î”)

  prefix-append : (Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’ prefixğ‘ƒğ‘œğ‘  (appendğ‘ƒğ‘œğ‘  Î“ Î”) â‰¡ Î“
  prefix-append Î“ âˆ… = refl
  prefix-append Î“ (Î” âŠ¹ A) = prefix-append Î“ Î”

  _+_ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) â†’ ğ‘ƒğ‘œğ‘  (prefixğ‘ƒğ‘œğ‘  ğ‘–) â†’ ğ‘ƒğ‘œğ‘  Î“
  ğ‘§ğ‘ + ğ‘— = ğ‘—
  ğ‘ ğ‘ ğ‘– + ğ‘— = ğ‘ ğ‘ (ğ‘– + ğ‘—)

  _++ğ‘ƒğ‘œğ‘ _ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) (Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’ ğ‘ƒğ‘œğ‘  (Î“ âŠ¹âŠ¹ Î”)
  ğ‘– ++ğ‘ƒğ‘œğ‘  âˆ… = ğ‘–
  ğ‘– ++ğ‘ƒğ‘œğ‘  (Î” âŠ¹ A) = ğ‘ ğ‘ (ğ‘– ++ğ‘ƒğ‘œğ‘  Î”)

  _++ğ‘‰ğ‘ğ‘Ÿ_ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) (Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’ ğ‘‰ğ‘ğ‘Ÿ (Î“ âŠ¹âŠ¹ Î”) A
  v ++ğ‘‰ğ‘ğ‘Ÿ âˆ… = v
  v ++ğ‘‰ğ‘ğ‘Ÿ (Î” âŠ¹ A) = ğ‘ ğ‘£ (v ++ğ‘‰ğ‘ğ‘Ÿ Î”)

  insertğ¶ğ‘¡ğ‘¥ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} â†’ ğ‘ƒğ‘œğ‘  Î“ â†’ ty â†’ ğ¶ğ‘¡ğ‘¥ ty
  insertğ¶ğ‘¡ğ‘¥ {Î“ = Î“} ğ‘§ğ‘ A = Î“ âŠ¹ A
  insertğ¶ğ‘¡ğ‘¥ {Î“ = Î“ âŠ¹ B} (ğ‘ ğ‘ p) A = insertğ¶ğ‘¡ğ‘¥ p A âŠ¹ B

  apInsertğ¶ğ‘¡ğ‘¥ : {Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty} {â‹† : ty} (p : Î“ â‰¡ Î”) (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) â†’
    insertğ¶ğ‘¡ğ‘¥ ğ‘– â‹† â‰¡ insertğ¶ğ‘¡ğ‘¥ (tr ğ‘ƒğ‘œğ‘  p ğ‘–) â‹†
  apInsertğ¶ğ‘¡ğ‘¥ refl ğ‘– = refl

  insertionğ‘‰ğ‘ğ‘Ÿ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) {A : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ (insertğ¶ğ‘¡ğ‘¥ ğ‘– A) A
  insertionğ‘‰ğ‘ğ‘Ÿ ğ‘§ğ‘ = ğ‘§ğ‘£
  insertionğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘ ğ‘–) = ğ‘ ğ‘£ (insertionğ‘‰ğ‘ğ‘Ÿ ğ‘–)

  insert++ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) (Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’
    insertğ¶ğ‘¡ğ‘¥ (ğ‘– ++ğ‘ƒğ‘œğ‘  Î”) A â‰¡ insertğ¶ğ‘¡ğ‘¥ ğ‘– A âŠ¹âŠ¹ Î”
  insert++ ğ‘– âˆ… = refl
  insert++ ğ‘– (Î” âŠ¹ A) = ap (_âŠ¹ A) (insert++ ğ‘– Î”)

  prefix++ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) (Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’
    prefixğ‘‰ğ‘ğ‘Ÿ (v ++ğ‘‰ğ‘ğ‘Ÿ Î”) â‰¡ prefixğ‘‰ğ‘ğ‘Ÿ v
  prefix++ v âˆ… = refl
  prefix++ v (Î” âŠ¹ A) = prefix++ v Î”

  remove++ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) (Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’
    removeğ‘‰ğ‘ğ‘Ÿ (v ++ğ‘‰ğ‘ğ‘Ÿ Î”) â‰¡ removeğ‘‰ğ‘ğ‘Ÿ v âŠ¹âŠ¹ Î”
  remove++ v âˆ… = refl
  remove++ v (Î” âŠ¹ A) = ap (_âŠ¹ A) (remove++ v Î”)

  shiftğ‘‰ğ‘ğ‘Ÿ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {B : ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) (v : ğ‘‰ğ‘ğ‘Ÿ Î“ B) {A : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ (insertğ¶ğ‘¡ğ‘¥ ğ‘– A) B
  shiftğ‘‰ğ‘ğ‘Ÿ ğ‘§ğ‘ v = ğ‘ ğ‘£ v
  shiftğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘ ğ‘–) ğ‘§ğ‘£ = ğ‘§ğ‘£
  shiftğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘ ğ‘–) (ğ‘ ğ‘£ v) = ğ‘ ğ‘£ (shiftğ‘‰ğ‘ğ‘Ÿ ğ‘– v)

  -- If ğ‘– â‰¡ ğ‘—, then this will point to the right of A
  shiftğ‘ƒğ‘œğ‘ â‚ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} (ğ‘— ğ‘– : ğ‘ƒğ‘œğ‘  Î“) {A : ty} â†’ ğ‘ƒğ‘œğ‘  (insertğ¶ğ‘¡ğ‘¥ ğ‘— A)
  shiftğ‘ƒğ‘œğ‘ â‚ ğ‘— ğ‘§ğ‘ = ğ‘§ğ‘
  shiftğ‘ƒğ‘œğ‘ â‚ {Î“ âŠ¹ B} ğ‘§ğ‘ (ğ‘ ğ‘ ğ‘–) = ğ‘ ğ‘ (shiftğ‘ƒğ‘œğ‘ â‚ ğ‘§ğ‘ ğ‘–)
  shiftğ‘ƒğ‘œğ‘ â‚ (ğ‘ ğ‘ ğ‘—) (ğ‘ ğ‘ ğ‘–) = ğ‘ ğ‘ (shiftğ‘ƒğ‘œğ‘ â‚ ğ‘— ğ‘–)

  -- If ğ‘– â‰¡ ğ‘—, then this will point to the left of A
  shiftğ‘ƒğ‘œğ‘ â‚‚ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} (ğ‘— ğ‘– : ğ‘ƒğ‘œğ‘  Î“) {A : ty} â†’ ğ‘ƒğ‘œğ‘  (insertğ¶ğ‘¡ğ‘¥ ğ‘— A)
  shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘§ğ‘ ğ‘– = ğ‘ ğ‘ ğ‘–
  shiftğ‘ƒğ‘œğ‘ â‚‚ (ğ‘ ğ‘ ğ‘—) ğ‘§ğ‘ = ğ‘§ğ‘
  shiftğ‘ƒğ‘œğ‘ â‚‚ (ğ‘ ğ‘ ğ‘—) (ğ‘ ğ‘ ğ‘–) = ğ‘ ğ‘ (shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘— ğ‘–)

  insertğ¶ğ‘¡ğ‘¥Â² : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) (ğ‘— : ğ‘ƒğ‘œğ‘  (prefixğ‘ƒğ‘œğ‘  ğ‘–)) â†’
    insertğ¶ğ‘¡ğ‘¥ (shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘– (ğ‘– + ğ‘—) {A}) B â‰¡ insertğ¶ğ‘¡ğ‘¥ (shiftğ‘ƒğ‘œğ‘ â‚ (ğ‘– + ğ‘—) ğ‘– {B}) A
  insertğ¶ğ‘¡ğ‘¥Â² ğ‘§ğ‘ ğ‘— = refl
  insertğ¶ğ‘¡ğ‘¥Â² {Î“ âŠ¹ A} {B} {C} (ğ‘ ğ‘ ğ‘–) ğ‘— = ap (_âŠ¹ A) (insertğ¶ğ‘¡ğ‘¥Â² {Î“} {B} {C} ğ‘– ğ‘—)

  trğ‘§ğ‘£ : {Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (p : Î“ â‰¡ Î”) â†’ tr (Î» Î£ â†’ ğ‘‰ğ‘ğ‘Ÿ Î£ A) (ap (_âŠ¹ A) p) ğ‘§ğ‘£ â‰¡ ğ‘§ğ‘£
  trğ‘§ğ‘£ refl = refl

  trğ‘ ğ‘£ : {Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (p : Î“ â‰¡ Î”) (v : ğ‘‰ğ‘ğ‘Ÿ Î“ B) â†’
    tr (Î» Î£ â†’ ğ‘‰ğ‘ğ‘Ÿ Î£ B) (ap (_âŠ¹ A) p) (ğ‘ ğ‘£ v) â‰¡ ğ‘ ğ‘£ (tr (Î» Î£ â†’ ğ‘‰ğ‘ğ‘Ÿ Î£ B) p v)
  trğ‘ ğ‘£ refl v = refl

  shiftğ‘‰ğ‘ğ‘ŸÂ² : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B C : ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) (ğ‘— : ğ‘ƒğ‘œğ‘  (prefixğ‘ƒğ‘œğ‘  ğ‘–)) (v : ğ‘‰ğ‘ğ‘Ÿ Î“ C) â†’
    tr (Î» Î” â†’ ğ‘‰ğ‘ğ‘Ÿ Î” C) (insertğ¶ğ‘¡ğ‘¥Â² ğ‘– ğ‘—) (shiftğ‘‰ğ‘ğ‘Ÿ (shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘– (ğ‘– + ğ‘—)) (shiftğ‘‰ğ‘ğ‘Ÿ ğ‘– v {A}) {B})
      â‰¡ shiftğ‘‰ğ‘ğ‘Ÿ (shiftğ‘ƒğ‘œğ‘ â‚ (ğ‘– + ğ‘—) ğ‘–) (shiftğ‘‰ğ‘ğ‘Ÿ (ğ‘– + ğ‘—) v)
  shiftğ‘‰ğ‘ğ‘ŸÂ² ğ‘§ğ‘ ğ‘— v = refl
  shiftğ‘‰ğ‘ğ‘ŸÂ² (ğ‘ ğ‘ ğ‘–) ğ‘— ğ‘§ğ‘£ = trğ‘§ğ‘£ (insertğ¶ğ‘¡ğ‘¥Â² ğ‘– ğ‘—)
  shiftğ‘‰ğ‘ğ‘ŸÂ² {Î“ = Î“ âŠ¹ A} {C = C} (ğ‘ ğ‘ ğ‘–) ğ‘— (ğ‘ ğ‘£ v) =
    tr (Î» Î£ â†’ ğ‘‰ğ‘ğ‘Ÿ Î£ C) (ap (_âŠ¹ A) (insertğ¶ğ‘¡ğ‘¥Â² ğ‘– ğ‘—)) (ğ‘ ğ‘£ (shiftğ‘‰ğ‘ğ‘Ÿ (shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘– (ğ‘– + ğ‘—)) (shiftğ‘‰ğ‘ğ‘Ÿ ğ‘– v)))
      â‰¡âŸ¨ trğ‘ ğ‘£ (insertğ¶ğ‘¡ğ‘¥Â² ğ‘– ğ‘—) (shiftğ‘‰ğ‘ğ‘Ÿ (shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘– (ğ‘– + ğ‘—)) (shiftğ‘‰ğ‘ğ‘Ÿ ğ‘– v)) âŸ©
    ğ‘ ğ‘£ (tr (Î» Î£ â†’ ğ‘‰ğ‘ğ‘Ÿ Î£ C) (insertğ¶ğ‘¡ğ‘¥Â² ğ‘– ğ‘—) (shiftğ‘‰ğ‘ğ‘Ÿ (shiftğ‘ƒğ‘œğ‘ â‚‚ ğ‘– (ğ‘– + ğ‘—)) (shiftğ‘‰ğ‘ğ‘Ÿ ğ‘– v)))
      â‰¡âŸ¨ ap ğ‘ ğ‘£ (shiftğ‘‰ğ‘ğ‘ŸÂ² ğ‘– ğ‘— v) âŸ©
    ğ‘ ğ‘£ (shiftğ‘‰ğ‘ğ‘Ÿ (shiftğ‘ƒğ‘œğ‘ â‚ (ğ‘– + ğ‘—) ğ‘–) (shiftğ‘‰ğ‘ğ‘Ÿ (ğ‘– + ğ‘—) v))
      âˆ

  removedğ‘ƒğ‘œğ‘  : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) â†’ ğ‘ƒğ‘œğ‘  Î“ â†’ ğ‘ƒğ‘œğ‘  (removeğ‘‰ğ‘ğ‘Ÿ v)
  removedğ‘ƒğ‘œğ‘  v ğ‘§ğ‘ = ğ‘§ğ‘
  removedğ‘ƒğ‘œğ‘  ğ‘§ğ‘£ (ğ‘ ğ‘ ğ‘–) = ğ‘–
  removedğ‘ƒğ‘œğ‘  (ğ‘ ğ‘£ v) (ğ‘ ğ‘ ğ‘–) = ğ‘ ğ‘ (removedğ‘ƒğ‘œğ‘  v ğ‘–)

  removalğ‘ƒğ‘œğ‘  : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) â†’ ğ‘ƒğ‘œğ‘  (removeğ‘‰ğ‘ğ‘Ÿ v)
  removalğ‘ƒğ‘œğ‘  ğ‘§ğ‘£ = ğ‘§ğ‘
  removalğ‘ƒğ‘œğ‘  (ğ‘ ğ‘£ v) = ğ‘ ğ‘ (removalğ‘ƒğ‘œğ‘  v)

  insert-remove : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ B) (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) â†’
    removeğ‘‰ğ‘ğ‘Ÿ (shiftğ‘‰ğ‘ğ‘Ÿ ğ‘– v {A}) â‰¡ insertğ¶ğ‘¡ğ‘¥ (removedğ‘ƒğ‘œğ‘  v ğ‘–) A
  insert-remove v ğ‘§ğ‘ = refl
  insert-remove ğ‘§ğ‘£ (ğ‘ ğ‘ ğ‘–) = refl
  insert-remove {Î“ âŠ¹ A} (ğ‘ ğ‘£ v) (ğ‘ ğ‘ ğ‘–) = ap (_âŠ¹ A) (insert-remove v ğ‘–)

  insert-removal : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) â†’
    insertğ¶ğ‘¡ğ‘¥ (removalğ‘ƒğ‘œğ‘  v) A â‰¡ Î“
  insert-removal ğ‘§ğ‘£ = refl
  insert-removal {Î“ âŠ¹ A} (ğ‘ ğ‘£ v) = ap (_âŠ¹ A) (insert-removal v)

  reinsertğ‘‰ğ‘ğ‘Ÿ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) â†’ ğ‘‰ğ‘ğ‘Ÿ (removeğ‘‰ğ‘ğ‘Ÿ v) B â†’ ğ‘‰ğ‘ğ‘Ÿ Î“ B
  reinsertğ‘‰ğ‘ğ‘Ÿ ğ‘§ğ‘£ w = ğ‘ ğ‘£ w
  reinsertğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘£ v) ğ‘§ğ‘£ = ğ‘§ğ‘£
  reinsertğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘£ v) (ğ‘ ğ‘£ w) = ğ‘ ğ‘£ (reinsertğ‘‰ğ‘ğ‘Ÿ v w)

  swapRemoveğ‘‰ğ‘ğ‘Ÿ : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) (w : ğ‘‰ğ‘ğ‘Ÿ (removeğ‘‰ğ‘ğ‘Ÿ v) B) â†’
    ğ‘‰ğ‘ğ‘Ÿ (removeğ‘‰ğ‘ğ‘Ÿ (reinsertğ‘‰ğ‘ğ‘Ÿ v w)) A
  swapRemoveğ‘‰ğ‘ğ‘Ÿ ğ‘§ğ‘£ w = ğ‘§ğ‘£
  swapRemoveğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘£ v) ğ‘§ğ‘£ = v
  swapRemoveğ‘‰ğ‘ğ‘Ÿ (ğ‘ ğ‘£ v) (ğ‘ ğ‘£ w) = ğ‘ ğ‘£ (swapRemoveğ‘‰ğ‘ğ‘Ÿ v w)

  remove-swap : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) (w : ğ‘‰ğ‘ğ‘Ÿ (removeğ‘‰ğ‘ğ‘Ÿ v) B) â†’
    removeğ‘‰ğ‘ğ‘Ÿ (swapRemoveğ‘‰ğ‘ğ‘Ÿ v w) â‰¡ removeğ‘‰ğ‘ğ‘Ÿ w
  remove-swap ğ‘§ğ‘£ w = refl
  remove-swap (ğ‘ ğ‘£ v) ğ‘§ğ‘£ = refl
  remove-swap {Î“ = Î“ âŠ¹ A} (ğ‘ ğ‘£ v) (ğ‘ ğ‘£ w) = ap (_âŠ¹ A) (remove-swap v w)

subsğ‘‰ğ‘ğ‘Ÿ : {ty : Type â„“â‚} {tm : ğ¶ğ‘¡ğ‘¥ ty â†’ ty â†’ Type â„“â‚‚} {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty}
  (V : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} â†’ ğ‘‰ğ‘ğ‘Ÿ Î“ A â†’ tm Î“ A)
  (shift : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} {A B : ty} (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) â†’ tm Î“ B â†’ tm (insertğ¶ğ‘¡ğ‘¥ ğ‘– A) B) â†’
  ğ‘‰ğ‘ğ‘Ÿ Î“ B â†’ (v : ğ‘‰ğ‘ğ‘Ÿ Î“ A) â†’ tm (prefixğ‘‰ğ‘ğ‘Ÿ v) A â†’ tm (removeğ‘‰ğ‘ğ‘Ÿ v) B
subsğ‘‰ğ‘ğ‘Ÿ V shift ğ‘§ğ‘£ ğ‘§ğ‘£ t = t
subsğ‘‰ğ‘ğ‘Ÿ V shift ğ‘§ğ‘£ (ğ‘ ğ‘£ v) t = V ğ‘§ğ‘£
subsğ‘‰ğ‘ğ‘Ÿ V shift (ğ‘ ğ‘£ w) ğ‘§ğ‘£ t = V w
subsğ‘‰ğ‘ğ‘Ÿ V shift (ğ‘ ğ‘£ w) (ğ‘ ğ‘£ v) t = shift ğ‘§ğ‘ (subsğ‘‰ğ‘ğ‘Ÿ V shift w v t)

trğ‘ƒğ‘œğ‘  : {tyâ‚ : Type â„“â‚} {tyâ‚‚ : Type â„“â‚‚} (f : tyâ‚ â†’ tyâ‚‚) {Î“ : ğ¶ğ‘¡ğ‘¥ tyâ‚}
  â†’ ğ‘ƒğ‘œğ‘  Î“ â†’ ğ‘ƒğ‘œğ‘  (mapğ¶ğ‘¡ğ‘¥ f Î“)
trğ‘ƒğ‘œğ‘  f ğ‘§ğ‘ = ğ‘§ğ‘
trğ‘ƒğ‘œğ‘  f (ğ‘ ğ‘ p) = ğ‘ ğ‘ (trğ‘ƒğ‘œğ‘  f p)

trInsertğ¶ğ‘¡ğ‘¥ : {tyâ‚ : Type â„“â‚} {tyâ‚‚ : Type â„“â‚‚} {Î“ : ğ¶ğ‘¡ğ‘¥ tyâ‚} {A : tyâ‚} (f : tyâ‚ â†’ tyâ‚‚) (ğ‘– : ğ‘ƒğ‘œğ‘  Î“) â†’
  mapğ¶ğ‘¡ğ‘¥ f (insertğ¶ğ‘¡ğ‘¥ ğ‘– A) â‰¡ insertğ¶ğ‘¡ğ‘¥ (trğ‘ƒğ‘œğ‘  f ğ‘–) (f A)
trInsertğ¶ğ‘¡ğ‘¥ f ğ‘§ğ‘ = refl
trInsertğ¶ğ‘¡ğ‘¥ {Î“ = Î“ âŠ¹ A} f (ğ‘ ğ‘ ğ‘–) = ap (_âŠ¹ f A) (trInsertğ¶ğ‘¡ğ‘¥ f ğ‘–)

{-infixl 20 _âŠ•_
data ğ‘‡ğ‘šğ‘  {ty : Type â„“â‚} (tm : ğ¶ğ‘¡ğ‘¥ ty â†’ ty â†’ Type â„“â‚‚)
     : (Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty) â†’ Type (â„“â‚ âŠ” â„“â‚‚) where
  ! : {Î“ : ğ¶ğ‘¡ğ‘¥ ty} â†’ ğ‘‡ğ‘šğ‘  tm Î“ âˆ…
  _âŠ•_ : {Î“ Î” : ğ¶ğ‘¡ğ‘¥ ty} {A : ty} â†’ ğ‘‡ğ‘šğ‘  tm Î“ Î” â†’ tm Î“ A â†’ ğ‘‡ğ‘šğ‘  tm Î“ (Î” âŠ¹ A)

mapğ‘‡ğ‘šğ‘  : {ty : Type â„“â‚} {Î“â‚ Î“â‚‚ Î” : ğ¶ğ‘¡ğ‘¥ ty} {tmâ‚ : ğ¶ğ‘¡ğ‘¥ ty â†’ ty â†’ Type â„“â‚‚}
  {tmâ‚‚ : ğ¶ğ‘¡ğ‘¥ ty â†’ ty â†’ Type â„“â‚ƒ} (f : {A : ty} â†’ tmâ‚ Î“â‚ A â†’ tmâ‚‚ Î“â‚‚ A)
  (Ïƒ : ğ‘‡ğ‘šğ‘  tmâ‚ Î“â‚ Î”) â†’ ğ‘‡ğ‘šğ‘  tmâ‚‚ Î“â‚‚ Î”
mapğ‘‡ğ‘šğ‘  f ! = !
mapğ‘‡ğ‘šğ‘  f (Ïƒ âŠ• t) = mapğ‘‡ğ‘šğ‘  f Ïƒ âŠ• f t

ğ‘…ğ‘’ğ‘› : (ty : Type â„“) â†’ ğ¶ğ‘¡ğ‘¥ ty â†’ ğ¶ğ‘¡ğ‘¥ ty â†’ Type â„“
ğ‘…ğ‘’ğ‘› ty = ğ‘‡ğ‘šğ‘  (ğ‘‰ğ‘ğ‘Ÿ {ty = ty})

module _ {ty : Type â„“} where
  private
    ctx = ğ¶ğ‘¡ğ‘¥ ty
    ren = ğ‘…ğ‘’ğ‘› ty
    var = ğ‘‰ğ‘ğ‘Ÿ {ty = ty}
  
  Wâ‚ğ‘…ğ‘’ğ‘› : {Î“ Î” : ctx} (A : ty) â†’ ren Î“ Î” â†’ ren (Î“ âŠ¹ A) Î”
  Wâ‚ğ‘…ğ‘’ğ‘› A = mapğ‘‡ğ‘šğ‘  ğ‘ ğ‘£

  Wâ‚‚ğ‘…ğ‘’ğ‘› : {Î“ Î” : ctx} (A : ty) â†’ ren Î“ Î” â†’ ren (Î“ âŠ¹ A) (Î” âŠ¹ A)
  Wâ‚‚ğ‘…ğ‘’ğ‘› A Ïƒ = Wâ‚ğ‘…ğ‘’ğ‘› A Ïƒ âŠ• ğ‘§ğ‘£

  idğ‘…ğ‘’ğ‘› : (Î“ : ctx) â†’ ren Î“ Î“
  idğ‘…ğ‘’ğ‘› âˆ… = !
  idğ‘…ğ‘’ğ‘› (Î“ âŠ¹ A) = Wâ‚‚ğ‘…ğ‘’ğ‘› A (idğ‘…ğ‘’ğ‘› Î“)

mapğ‘‡ğ‘šğ‘ ğ¶ğ‘¡ğ‘¥ : {tyâ‚ : Type â„“â‚} {tyâ‚‚ : Type â„“â‚‚} {Î“ Î” : ğ¶ğ‘¡ğ‘¥ tyâ‚} {tm : ğ¶ğ‘¡ğ‘¥ tyâ‚ â†’ tyâ‚ â†’ Type â„“â‚ƒ}
  (f : {A : tyâ‚} â†’ tm Î“ A â†’ tyâ‚‚) â†’ ğ‘‡ğ‘šğ‘  tm Î“ Î” â†’ ğ¶ğ‘¡ğ‘¥ tyâ‚‚
mapğ‘‡ğ‘šğ‘ ğ¶ğ‘¡ğ‘¥ f ! = âˆ…
mapğ‘‡ğ‘šğ‘ ğ¶ğ‘¡ğ‘¥ f (Ïƒ âŠ• t) = mapğ‘‡ğ‘šğ‘ ğ¶ğ‘¡ğ‘¥ f Ïƒ âŠ¹ f t-}
